{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Crescendo - Home{% endblock title %}</title>
    <link rel="stylesheet" href="{% static 'CSS/style.css' %}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Trirong">
</head>
<body>
  {% block content %}
  <header class="main-header" style=" height: 8vh; padding: 1px 10px;">
    <div class="header-content" style="justify-content: space-between;">
      <img class="home-logo" src="https://i.ibb.co/svjdswsL/Gemini-Generated-Image-2zckw52zckw52zck-removebg-preview.png" alt="Gemini Generated Image 2zckw52zckw52zck removebg preview" border="0">
      <button class="logout-button-home" onclick="logout()">Logout</button>
    </div>
  </header>
  <section class="user-profile">
    <div>
      <img src="{% static 'images/' %}{{ user_details.user_class }}.png" class="profile-image" alt="profile-image" border="0">
      <p class="sub-class-display">{{ user_details.user_class }}</p>
    </div>
    <div class="name-and-level">
        <p class="username">{{ user_details.user }} : Level {{ user_details.level }}</p>
      <progress class="level-progress" value="{{ xp_progress }}" max="{{ level_range }}"></progress><label for="level-progress">{{ xp_progress }} / {{ level_range }}</label>
      <div>
        <p>Total xp gained: {{user_details.xp}}</p>
        <p>XP required for next level: {{ xp_to_gain }}</p>
      </div>
    </div>
    <div class="quests-count">
      <p>Current active quests: {{ Quests.count }}</p>
      <p>Total quests completed: {{ completed_quests.count }}</p>
    </div>
  </section>
  <section class="quests-body">
  <section class="quests-section">
    <div class="active-heading">
      <h1 class="heading">Active Quests</h1>
      {% if Quests.count != 0 %}
      <details class="dropdown">
        <summary class="add-quest-button">+</summary>
        <form method="post" class="add-quest-form">
          {% csrf_token %}
          {{ listform }}
          <button type="submit">Add Quest</button>
        </form>
      </details>
      {% endif %}
    </div>
      {% if Quests.count != 0 or active_roadmaps %}
      {% for quest in Quests %}
      <div class="quest-card">
        <div>
          <h2>{{ quest.name }}</h2>
          <form action="{% url 'delete_quest' quest.id %}" method="POST" style="display:inline;">
            {% csrf_token %}
            <button type="submit" class="delete-btn" onclick="return confirm('Are you sure you want to delete this quest?');">
                Delete
            </button>
        </form>
        </div>
        <button class="open-btn" onclick="window.location.href = '/{{ quest.name }}/'">open</button>
        <p class="quest-date">{{ quest.created_at|date:"M d, Y" }}</p>
      </div>
      {% endfor %}
      {% for roadmap in active_roadmaps %}
      <div class="quest-card">
        <div>
          <h2>üó∫Ô∏è {{ roadmap.quest.name }}</h2>
          <span class="roadmap-badge">{{ roadmap.quest.category }} Roadmap</span>
        </div>
        <button class="open-btn" onclick="window.location.href='{% url 'open_roadmap' roadmap.id %}'">Open</button>
      </div>
      {% endfor %}
    {% else %}
      <div class="empty">
        <p>No active quests available. Click to add new quest</p>
        <details class="dropdown">
        <summary class="add-quest-button">+</summary>
        <form method="post">
          {% csrf_token %}
          <div class="add-quest-form">
            {% for field in listform %}
            {{ field }}
            {% endfor %}
            <button type="submit">Add Quest</button>
          </div>
        </form>
      </details>
      </div>
    {% endif %}
    <h1 class="heading">Completed Quests</h1>
    {% if completed_quests.count > 0 %}
    {% for quest in completed_quests %}
      <div class="quest-card">
        <div>
          <h2><strike>{{ quest.name }}</strike></h2>
          <form action="{% url 'delete_quest' quest.id %}" method="POST" style="display:inline;">
            {% csrf_token %}
            <button type="submit" class="delete-btn" onclick="return confirm('Are you sure you want to delete this quest?');">
                Completed
            </button>
        </form>
        </div>
        <button class="open-btn" onclick="window.location.href = '/{{ quest.name }}/'">open</button>
      </div>
      {% endfor %}
    {% else %}
      <div class="empty-completed">
        <p>No completed quests yet. Complete some quests to see them here!</p>
      </div>
    {% endif %}
      <h1 class="stat-heading">Available Roadmaps</h1>
    {% if available_roadmaps %}
    <div class="roadmap-container">
      {% for roadmap in available_roadmaps %}
      <div class="quest-card">
        <div>
          <h2>üó∫Ô∏è {{ roadmap.name }}</h2>
          <span class="roadmap-badge">{{ roadmap.category }} Roadmap</span>
        </div>
        <p>Reward: {{ roadmap.xp_reward }} XP | +{{ roadmap.trophy_reward }} {{ roadmap.category }}</p>
        <button class="open-btn" onclick="window.location.href='{% url 'start_roadmap' roadmap.id %}'">
          Start Roadmap
        </button>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="empty-completed">
      <p>No roadmaps available at the moment.</p>
    </div>
    {% endif %}
  </section>
  <section class="stats-section">
    <h1 class="stat-heading">Stats</h1>
    {% for stat in mental_stats %}
    <div class="stat-card">
      <h2>{{ stat.name }}: Rank {{ stat.rank }}</h2>
      <p>Type: Mental</p>
      <progress class="stat-progress" value="{{ stat.trophies }}" max="100"></progress><label for="stat-progress">{{ stat.trophies }} trophies</label>
    </div>
    {% endfor %}
    {% for stat in physical_stats %}
    <div class="stat-card">
      <h2>{{ stat.name }}: Rank {{ stat.rank }}</h2>
      <p>Type: Physical</p>
      <progress class="stat-progress" value="{{ stat.trophies }}" max="100"></progress><label for="stat-progress">{{ stat.trophies }} trophies</label>
    </div>
    {% endfor %}
  </section>
  </section>
  {% endblock content%}
  <script>
    function logout() {
      window.location.href = '/auth/logout/';
    }
  </script>
</body>
</html>